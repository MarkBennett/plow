#!/usr/bin/env bash

set -e

bail() {
  echo "  failed: $1"
  exit 1
}

recipe() {
  wget -nc -qP .plow $1
  source .plow/$(basename "$1")
}

while test $# != 0; do
  case "$1" in
    --staging|staging)
      [[ -f .env.staging ]] || bail "no .env.staging found"
      source .env.staging
      ;;
    --production|production)
      [[ -f .env.production ]] || bail "no .env.production found"
      source .env.production
      ;;
    --rev=*)
      REF="${1#--rev=}"
      ;;
    *)
      export $1=true
      ;;      
  esac
  shift
done

recipe https://gist.github.com/mm53bar/5053150/raw/b854cdd4a3204e1d5f1de8b42d245ed729736cb0/test
recipe https://gist.github.com/mm53bar/5053150/raw/9c883ff5bf4f50f2f4c59e5a1e4ed321b49ab39f/gitrev

